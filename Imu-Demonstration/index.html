<html>
<head>
    <script src="/jquery.js"></script>
    <script src="/three.min.js"></script>
    <script type="text/javascript">
        /**
         * [description]
         * @param  {[type]} data [description]
         * @return {[type]}      [description]
         */
        var onSerialSuccess = function(data) {
            globalData = data;
            document.getElementById("port").innerText = data.port;
            document.getElementById("pitch").innerText = data.imu.pitch;
            document.getElementById("roll").innerText = data.imu.roll;
            document.getElementById("yaw").innerText = data.imu.yaw;
        };

        /**
         * [description]
         * @param  {[type]} response [description]
         * @return {[type]}          [description]
         */
        var onSerialError = function(response) {
            // TODO
        };

        /**
         * [description]
         * @return {[type]} [description]
         */
        $(document).ready(function() {
            setInterval(function() {
                $.ajax({
                    url: '/api/serial',
                    method: 'GET',
                    dataType: "json",
                    success: onSerialSuccess,
                    error: onSerialError
                });
            }, 100);

            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(75, 640/480, 0.1, 1000);
            var renderer = new THREE.WebGLRenderer({ alpha: true, canvas: document.getElementById("canvas"), antialias: true });
            renderer.setSize(640, 480);

            var geometry = new THREE.BoxGeometry( 1, 1, 1 );
            var geo = new THREE.EdgesGeometry( geometry ); // or WireframeGeometry( geometry )
            var mat = new THREE.LineBasicMaterial( { color: 0x002C5D, linewidth: 2 } );
            var wireframe = new THREE.LineSegments( geo, mat );
            scene.add( wireframe );

            camera.position.z = 2;

            function render() {
            	requestAnimationFrame( render );
            	renderer.render( scene, camera );
                wireframe.rotation.x = parseInt(globalData.imu.pitch);
                wireframe.rotation.y = parseInt(globalData.imu.roll);
                wireframe.rotation.z = parseInt(globalData.imu.yaw);
            }
            render();
        });
    </script>
    <style>
        *, *::before, *::after {
            box-sizing:border-box;
        }

        body {
            text-align:center;
            padding:50px 100px;
        }

        p, ul, li, span {
            font-family:'Fira Code';
        }

        header {
            margin-bottom:50px;
        }

        .header {
            text-align: center;
            font-size: 2em;
            font-weight: 100;
            display: inline-block;
            height:70px;
            line-height:70px;
            background-color: #80c8ff;
            padding:0 1em;
            margin:0.4em;
            position:relative;
            clear:both;
        }

        .header::before, .header::after {
            content:"";
            width: 0;
            height: 0;
            border-style: solid;
            z-index:1;
            position:absolute;
            top:0;
        }

        .header::before {
            right:-50px;
            border-style: solid;
            border-width: 70px 50px 0 0;
            border-color: #80c8ff transparent transparent transparent;
        }

        .header::after {
            border-width: 0 50px 70px 0;
            border-color: transparent #80c8ff transparent transparent;
            left:-50px;
        }

        .port-output {
            font-style: italic;
            color: #6c6c6c;
            display:table;
            margin:0 auto;
        }

        #port {
            font-weight:bold;
        }

        .disclaimer {
            font-size:smaller;
            clear:both;
        }

        .half-width {
            float:left;
            width:50%;
        }

        .large-display {
            float:left;
            width:33.3%;
            text-align:right;
        }

        .large-display .value {
            font-size:32px;
            font-weight:left;
            display:block;
        }
    </style>
</head>
<body>
    <header>
        <p class="header">Realtime IMU Demonstration</p>
        <p class="port-output">Reading IMU data from port <span id="port"></span></p>
    </header>
    <div class="half-width">
        <canvas id="canvas"></canvas>
    </div>
    <div class="half-width">
        <div class="large-display">
            <span class="value"><span id="pitch"></span>°</span>
            <span class="key">Pitch</span>
        </div>
        <div class="large-display">
            <span class="value"><span id="roll"></span>°</span>
            <span class="key">Roll</span>
        </div>

        <div class="large-display">
            <span class="value"><span id="yaw"></span>°</span>
            <span class="key">Yaw</span>
        </div>
        <div class="small-display">
            <span class="value"><span id="accel_x"></span></span>
            <span class="key">Accel_X</span>
        </div>
        <div class="small-display">
            <span class="value"><span id="accel_y"></span></span>
            <span class="key">Accel_Y</span>
        </div>
        <div class="small-display">
            <span class="value"><span id="accel_z"></span></span>
            <span class="key">Accel_Z</span>
        </div>
    </div>
    <p class="disclaimer">Refreshing at a rate of <strong>10Hz</strong>. <br/>Note that the serial port &amp; IMU can output data much faster, this 10Hz limitation arises from the speed and number of requests we can reasonably make to the HTTP server.</p>
</body>
</html>
